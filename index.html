<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cube XR - SAE 4.02</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>

  
  <script src="src/components/water-effect.js"></script>
  <script src="src/components/grab-manager.js"></script>

  <link rel="stylesheet" href="src/styles/style.css">
</head>

<body>
  <!-- Bouton pour entrer en mode AR -->
  <div id="ar-overlay">
    <button id="ar-button">Entrer en AR ðŸ¥½</button>
  </div>

  <!-- ScÃ¨ne A-Frame avec configuration WebXR native pour AR -->
  <a-scene webxr="referenceSpaceType: local-floor; overlayElement: #ar-overlay;"
    grab-manager
    physics="gravity: 0"
    renderer="colorManagement: true; alpha: true; antialias: true; sortTransparentObjects: true">

    <!-- Assets must be inside a-scene -->
    <a-assets>
      <a-asset-item id="spear-model" src="assets/models/stylized_low-poly_spear.glb"></a-asset-item>
      <a-asset-item id="low_poly_fish" src="assets/models/low_poly_fish.glb"></a-asset-item>
    </a-assets>

    <!-- Ancre monde : tous les objets 3D sont enfants de cette entitÃ© pour rester fixes dans l'espace rÃ©el -->
    <a-entity id="world-anchor">


      <!-- EFFET D'EAU QUI MONTE avec shader Three.js (positionnÃ©e dans le monde, pas au niveau de la camÃ©ra) -->
      <a-entity id="water-surface" position="0 0 -2"
        animation="property: position; from: 0 0 -2; to: 0 2.5 -2; dur: 10000; easing: easeInOutQuad">

        <!-- Surface d'eau avec effet de vagues fluides -->
        <a-entity id="water-fluid"
          water-shader="color: #0088cc; opacity: 0.65; speed: 1.5; waveHeight: 0.08; waveFrequency: 1.5">
        </a-entity>

        <!-- DeuxiÃ¨me couche d'eau plus claire pour la profondeur -->
        <a-entity position="0 -0.05 0"
          water-shader="color: #00aaff; opacity: 0.3; speed: 0.8; waveHeight: 0.05; waveFrequency: 2.0">
        </a-entity>
      </a-entity>

      <!-- Particules de bulles qui montent avec l'eau -->
      <a-entity id="bubbles" position="0 0 -2">
        <a-sphere position="-0.5 0.2 0" radius="0.05" color="#ffffff" opacity="0.5"
          animation="property: position; from: -0.5 0.2 0; to: -0.5 2.7 0; dur: 8000; easing: linear"></a-sphere>
        <a-sphere position="0.3 0.1 -0.5" radius="0.03" color="#ffffff" opacity="0.4"
          animation="property: position; from: 0.3 0.1 -0.5; to: 0.3 2.6 -0.5; dur: 7000; easing: linear; delay: 500"></a-sphere>
        <a-sphere position="0 0.3 0.3" radius="0.04" color="#ffffff" opacity="0.5"
          animation="property: position; from: 0 0.3 0.3; to: 0 2.8 0.3; dur: 9000; easing: linear; delay: 1000"></a-sphere>
        <a-sphere position="0.7 0.15 -0.2" radius="0.035" color="#ffffff" opacity="0.4"
          animation="property: position; from: 0.7 0.15 -0.2; to: 0.7 2.65 -0.2; dur: 7500; easing: linear; delay: 300"></a-sphere>
        <a-sphere position="-0.3 0.25 0.5" radius="0.045" color="#ffffff" opacity="0.5"
          animation="property: position; from: -0.3 0.25 0.5; to: -0.3 2.75 0.5; dur: 8500; easing: linear; delay: 700"></a-sphere>
      </a-entity>

      <!-- LumiÃ¨res -->
      <a-light type="ambient" color="#ffffff" intensity="0.6"></a-light>
      <a-light type="directional" color="#ffffff" intensity="0.8" position="1 2 1"></a-light>
      <!-- LumiÃ¨re bleutÃ©e sous l'eau -->
      <a-light type="point" color="#0088ff" intensity="0.5" position="0 0.5 -2"></a-light>

      <!-- Spear model (replace the blue cube) - grabbable -->
      <a-entity id="spear" class="fish" position="0 1.45 -0.6" rotation="0 90 0" 
                geometry="primitive: box; width: 0.05; height: 0.05; depth: 0.6" 
                material="color: #ff0000; opacity: 0.3; transparent: true"
                gltf-model="#spear-model"
                scale="0.5 0.5 0.5">
      </a-entity>

      <!-- Fish cube to catch -->
            <a-entity class="fish-target" position="-1.4 1.0 -1.2" 
              gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 45 0"
             animation="property: position; to: -1.2 1.2 -1.5; dur: 3000; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 90 0; dur: 3000; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 2 -->
      <a-entity class="fish-target" position="1.4 2.2 -2.4" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 -60 0"
             animation="property: position; to: 1.2 1.9 -2.6; dur: 3500; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 -120 0; dur: 3500; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 3 -->
      <a-entity class="fish-target" position="0.2 1.6 -3.1" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 0 0"
             animation="property: position; to: -0.1 1.7 -3.3; dur: 4000; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 60 0; dur: 4000; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 4 -->
      <a-entity class="fish-target" position="-1.3 2.3 -2.7" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 30 0"
             animation="property: position; to: -1.1 2.0 -2.9; dur: 3200; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 -30 0; dur: 3200; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 5 -->
      <a-entity class="fish-target" position="1.3 1.1 -0.9" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 -90 0"
             animation="property: position; to: 1.5 1.4 -1.1; dur: 2800; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 -150 0; dur: 2800; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 6 -->
      <a-entity class="fish-target" position="-0.7 1.9 -1.0" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 75 0"
             animation="property: position; to: -0.5 1.6 -1.2; dur: 3100; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 135 0; dur: 3100; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 7 -->
      <a-entity class="fish-target" position="0.9 1.3 -2.8" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 -45 0"
             animation="property: position; to: 0.7 1.6 -3.0; dur: 3600; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 -105 0; dur: 3600; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      <!-- Fish 8 -->
      <a-entity class="fish-target" position="-0.4 1.4 -2.0" 
             gltf-model="#low_poly_fish"
             scale="0.08 0.08 0.08"
             rotation="0 15 0"
             animation="property: position; to: -0.6 1.7 -2.2; dur: 2900; easing: easeInOutSine; loop: true; dir: alternate"
             animation__rotate="property: rotation; to: 0 75 0; dur: 2900; easing: easeInOutSine; loop: true; dir: alternate">
      </a-entity>

      </a-entity>

    <!-- VR Hands -->
    <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: lowPoly; color: #15ACCF"></a-entity>
    <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: lowPoly; color: #15ACCF"></a-entity>

  </a-scene>

  <script src="src/systems/game-manager.js"></script>
</body>

</html>